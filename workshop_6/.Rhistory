library(SummarizedExperiment)
library(sva)
library(TBSignatureProfiler)
indata <- readRDS("indata.rds")
indata <- readRDS("combat_indata.rds")
indata <- readRDS("combat_indata.rds")
View(indata)
assays(indata)
colData(indata)$Tb_status
colData(indata)$bmi_cat2
model.matrix(~colData(indata)$Tb_status + colData(indata)$bmi_cat2)
indata <- readRDS("combat_indata.rds")
batch <- indata$batch
covs <- model.matrix(~colData(indata)$Tb_status + colData(indata)$bmi_cat2)
combat_counts <- ComBat_seq(as.matrix(assay(indata, "counts")),
batch = batch, covar_mod = covs)
assay(indata, "combat") <- combat_counts
indata <-readRDS("combat_indata.rds")
predictors <- rownames(colData(indata))
predictors
predictors <- colnames(colData(indata))
predictors
predictors <- rownames(indata)
predictors <- rownames(indata)
predictors
library(h2o)
library(SummarizedExperiment)
h2o.init()
indata <-readRDS("combat_indata.rds")
predictors <- rownames(indata)
well_indata <- indata[,indata$bmi_cat2=="well"]
mal_indata <- indata[,indata$bmi_cat2=="mal"]
datframe_well <- data.frame(TB_status=as.factor(well_indata$Tb_status),t(assay(well_indata,"log_combat_cpm")))
datframe_mal <- data.frame(TB_status=as.factor(mal_indata$Tb_status),t(assay(mal_indata,"log_combat_cpm")))
train <- as.h2o(datframe_well)
valid <- as.h2o(datframe_mal)
indata_automl <- h2o.automl(x = predictors, y = "TB_status",
training_frame = train,
max_runtime_secs = 20, seed = 1,
validation_frame = valid,
sort_metric = "AUCPR",)
train <- as.h2o(datframe_well)
valid <- as.h2o(datframe_mal)
predictors <- colnames(train)
indata_automl <- h2o.automl(x = predictors, y = "TB_status",
training_frame = train,
max_runtime_secs = 20, seed = 1,
validation_frame = valid,
sort_metric = "AUCPR",)
lb <- h2o.get_leaderboard(indata_automl)
head(lb)
indata_automl <- h2o.automl(x = predictors, y = "TB_status",
training_frame = train,
max_runtime_secs = 20, seed = 1,
validation_frame = valid,
leaderboard_frame = valid)
lb <- h2o.get_leaderboard(indata_automl)
head(lb)
